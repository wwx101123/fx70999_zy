<!DOCTYPE html>
<html>

	<head>
		<!-- meta标签设置-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,
     maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!-- app标题 -->
		<title>拨打电话</title>
		<script src="../js/jquery/jquery-1.11.2.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/fontSize.js"></script>
		<script src="../js/user.js"></script>
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/reset1.css">
		<link rel="stylesheet" href="../css/layout.css">
		<link rel="stylesheet" href="../css/wcPop.css">
		<link rel="stylesheet" href="../css/style.css">
		<link rel="stylesheet" href="../css/mescroll.min.css">
		<link rel="stylesheet" href="../css/mescroll-option.css">
		<script src="../js/mescroll-option.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mescroll.min.js" charset="utf-8"></script>
	</head>

	<body style="background: #efeff4;">
		<div class="swiper-slide swiper-slide-active page__bd mescroll" id="mescroll" style="width: 100%;margin-top:0%;">
			<div class="search-box" style="margin: 0;padding-BOTTOM: 0px;    width: 95%; margin: 0 auto; border-radius: 10px; ">
				<div class="input-box">
					<input id="keywords" name="keywords" type="text" placeholder="输入姓名或者手机号快速搜索">
					<a href="javascript:;" onclick="SiteSearch('#keywords');">
						<i class="mui-icon mui-icon-search"></i>
					</a>
				</div>
			</div>
			
			<div class="wc__scrolling-panel detail-list">
				<div class="wc__addrFriend-list" id="J__addrFriendList">
					
					<ul class="clearfix friend_list">
						<div class="nodata" style="display: none;margin-top: 0%;">
							<img src="../images/app_assets_images_home_card_nodate.png" width="150" height="150" />

							<div class="txt">没有盟友</div>

						</div>
					</ul>
				</div>

			</div>
			<!-- //字母显示 -->
			<div class="wc__addrFriend-showletter" style="display: none;">A</div>
			<!-- //26字母 -->
			<div class="wc__addrFriend-floatletter" style="top:140PX;">
				<em>A</em>
				<em>B</em>
				<em>C</em>
				<em>D</em>
				<em>E</em>
				<em>F</em>
				<em>G</em>
				<em>H</em>
				<em>I</em>
				<em>J</em>
				<em>K</em>
				<em>L</em>
				<em>M</em>
				<em>N</em>
				<em>O</em>
				<em>P</em>
				<em>Q</em>
				<em>R</em>
				<em>S</em>
				<em>T</em>
				<em>U</em>
				<em>V</em>
				<em>W</em>
				<em>X</em>
				<em>Y</em>
				<em>Z</em>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		var user_id = localStorage.getItem('user_id');

		init()

		function init() {
			//			localStorage.setItem('keywords', '')
			//			mui.init({
			//				pullRefresh: {
			//					container: '.page__bd',
			//					down: {
			//						style: 'circle',
			//						color: localStorage.getItem('color'),
			//						auto: true,
			//						callback: down
			//					}
			//				}
			//			});

		}

		//		function down() {
		//			var keywords = localStorage.getItem('keywords');
		//			console.log(keywords)
		//			var user_id = localStorage.getItem('user_id');
		//
		//			get_user_team()
		//
		//			mui('.page__bd').pullRefresh().endPulldown();
		//		}
		/*搜索查询*/
	</script>
	<script type="text/javascript">
		/** __公共函数 */
		$(function() {
			// 顶部添加按钮
			$(".wc__headerBar").on("click", "#J__topbarAdd", function() {
				$("#J__popupTopBar").show();
			});
			$("#J__popupTopBar").on("click", ".wrap__topbar-mask", function() {
				$(this).parent().hide();
			});
			// 禁止长按弹出系统菜单
			$(".wechat__panel").on("contextmenu", function(e) {
				e.preventDefault();
			});
		});

		/** __自定函数 */
		$(function() {
			//***1、微聊-------------------------
			// 聊天记录页面（长按操作）
			$("#J__recordChatList").on("longTap", "li", function(e) {
				var _this = $(this);
				wcPop({
					skin: 'androidSheet',
					shadeClose: true,

					btns: [{
							text: '标为未读',
							style: 'line-height:50px;'
						},
						{
							text: '置顶聊天',
							style: 'line-height:50px;'
						},
						{
							text: '删除该聊天',
							style: 'line-height:50px;',
							onTap() {
								wcPop({
									skin: 'android',
									content: '删除后，将会清空该聊天记录',

									btns: [{
											text: '取消',
											onTap() {
												wcPop.close();
											}
										},
										{
											text: '删除',
											style: 'color:#ffba00',
											onTap() {
												_this.remove();
												wcPop.close();
											}
										}
									]
								});
							}
						}
					]
				});
			});
			// 跳转链接
			$(".wechat__panel").on("click", "*[routeUrl]", function(e) {
				var routeurl = $(this).attr('routeUrl');
				if(!routeurl) return;
				window.location.href = routeurl;
			});

			//***2、通讯录-------------------------
			// 右侧浮动条
			$(".wc__addrFriend-floatletter").on("click", "em", function() {
				var letter = $(this).text();
				if($("#" + letter).length > 0) {
					// 滚动到指定位置
					//$("#J__addrFriendList").parent().animate({ scrollTop: $("#" + letter).position().top}, 300);
					document.getElementById(letter).scrollIntoView();
				}
				$(".wc__addrFriend-showletter").text(letter).fadeIn(300);

				setTimeout(function() {
					$(".wc__addrFriend-showletter").fadeOut(300);
				}, 500);
			});

			// 通讯录（长按操作）
			$("#J__addrFriendList li:not(:first-child)").on("longTap", ".row", function(e) {
				var _this = $(this);
				wcPop({
					skin: 'androidSheet',
					shadeClose: true,

					btns: [{
						text: '设置备注及标签',
						style: 'line-height:50px;',
						onTap() {
							wcPop.close();
						}
					}]
				});
			});
		});
	</script>

	<script type="text/javascript">
		function init() {
			$('.goods_list a').remove()
			var page_index = 0;
			localStorage.setItem('page_index', page_index);
			//			localStorage.setItem('category_id', 0)
			//			mescroll.resetUpScroll();

		}

		var mescroll;
		$(function() {
			localStorage.setItem('tel_type',1)

			//			localStorage.setItem('category_id', 0)
			//			$('.mescroll').css('top', $('#sliderSegmentedControl').height() + 44);
			//获取商城类别

			var size = 10;
			var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
			mescroll = initMeScroll("mescroll", {
				down: {
					auto: true, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
					callback: downCallback //下拉刷新的回调
				},
				up: {
					auto: false, //是否在初始化时以上拉加载的方式自动加载第一页数据; 默认false
					isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
					callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page) { upCallback(page); }
					page: {
						num: 0, //当前页 默认0,回调之前会加1; 即callback(page)会从1开始
						size: size //每页数据条数,默认10
					},
					toTop: { //配置回到顶部按钮
						src: "../img/mescroll-totop.png"
					},
					htmlNodata: '<p class="upwarp-nodata">暂无数据</p>',
					noMoreSize: size,
					lazyLoad: {
						use: true, // 是否开启懒加载,默认false
						attr: 'imgurl', // 网络地址的属性名 (图片加载成功会移除该属性): <img imgurl='网络图  src='占位图''/>
						showClass: 'mescroll-lazy-in', // 图片加载成功的显示动画: 渐变显示,参见mescroll.css
						delay: 100, // 列表滚动的过程中每500ms检查一次图片是否在可视区域,如果在可视区域则加载图片
						offset: 200 // 超出可视区域200px的图片仍可触发懒加载,目的是提前加载部分图片
					}
				}
			});

			function getListDataFromNet(pageNum, pageSize, successCallback, errorCallback) {
				//延时一秒,模拟联网

				try {
					//					console.log(category_id)
					get_user_team(pageNum, pageSize, successCallback);
				} catch(e) {
					//联网失败的回调
					errorCallback && errorCallback();
				}

			}
			var page_index = 0;
			localStorage.setItem('page_index', page_index);
			/*下拉刷新的回调 */
			function downCallback() {
				var page_index = 0;
				//					page_index = parseInt(page_index) + 1;
				localStorage.setItem('page_index', page_index);
				//联网加载数据
				getListDataFromNet(page_index, size, function(data) {
					//联网成功的回调,隐藏下拉刷新的状态
					mescroll.endSuccess();
					var curPageData = localStorage.getItem('ListData');
					//设置列表数据
					setListData(curPageData);
					//			down();
				}, function() {
					//联网失败的回调,隐藏下拉刷新的状态
					mescroll.endErr();
				});
			}

			/*上拉加载的回调 */
			function upCallback(page) {
				var page_index = page.num;
				//					page_index = parseInt(page_index) + 1;
				localStorage.setItem('page_index', page_index);
				//					page_index = localStorage.getItem('page_index');
				//联网加载数据
				getListDataFromNet(page_index, page.size, function(curPageData) {
					//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
					//mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据; 

					var ListData = localStorage.getItem('ListData');

					var data = JSON.parse(ListData);
					//			mescroll.endBySize(list_count, total_count);
					//方法一(推荐): 后台接口有返回列表的总页数 totalPage
					//mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

					//方法二(推荐): 后台接口有返回列表的总数据量 totalSize
					//						 mescroll.endBySize(data.data.length, data.count); //必传参数(当前页的数据个数, 总数据量)

					//方法三(推荐): 您有其他方式知道是否有下一页 hasNext
					//mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

					//方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.

					mescroll.endSuccess(data.current_count);

					//提示:curPageData.length必传的原因:
					// 1.判断是否有下一页的首要依据: 当传的值小于page.size时,则一定会认为无更多数据.
					// 2.比传入的totalPage, totalSize, hasNext具有更高的判断优先级
					// 3.使配置的noMoreSize生效

					//设置列表数据
					var curPageData = localStorage.getItem('ListData');
					setListData(curPageData, true);
				}, function() {
					//联网失败的回调,隐藏下拉刷新和上拉加载的状态;
					mescroll.endErr();
				});
			}

			function setListData(data) {

				data = JSON.parse(data);
				$('.wc__addrFriend-list .friend_list li').remove();
				$('.wc__addrFriend-list .nodata').css('display', 'none');
				var status = data.status;
				if(status == 1) {
					var info = data.data;

					$('.active_count').html(data.active_count);
					$('.no_active_count').html(data.no_active_count);

					var pinyin = '';
					if(info != null) {
						$.each(info, function(index, content) {
							console.log(content.py)
							if(pinyin != content.py) {
								pinyin = content.py;
								var item = '<li id="' + content.py + '">';
								item += '<h2 class="initial wc__borT">' + content.py + '</h2>';

								$.each(info, function(index1, content1) {
									if(content1.py == pinyin) {
										console.log(content1.id)
										item += '<div class="row flexbox flex-alignc wc__material-cell view_user" view_user_id="' + content1.id + '" >';
										item += '	<img class="uimg" src="' + UploadUrl + content1.avatar + '">';
										item += '	<div class="row_div1"><span class="name flex1">' + content1.user_name + '</span></div>';
										item += '	<div class="row_div2" style="text-align: right;" ><img class="mobile" mobile="' + content1.user_id + '"  src="../images/phone.png" width="20px" ><img user_id="' + content1.id + '"  class="view"   src="../images/flows.png" width="20px" style="margin-left:10px;display:none" ></div>';
										//									item += '	<div class="row_div2"><span class="money flex1">' + content.trade_money + '元</span><span class="name flex1">交易额</span></div>';
										//									item += '	<div class="row_div2"><span class="money flex1">' + content.user_num + '人</span><span class="name flex1">盟友</span></div>';
										item += '</div>';
									}
								})
								item += '	</li>';
								$('.wc__addrFriend-list .friend_list').append(item);
							}
						})

						$(".mobile").on('click', function() {
							location.href = "tel:" + $(this).attr('mobile')
						})
					} else {

						$('.nodata').css('display', 'block');
					}

					$('.user_name').html(data.user.user_name);
					$('.user_id').html(data.user.user_id);

					$('.view').attr('view_user_id', data.user.id);
					$('.my .mobile').attr('mobile', data.user.re_name);
					$(".view").click(function() {
						localStorage.setItem('view_user_id', $(this).attr('view_user_id'))
						console.log($(this).attr('view_user_id'))
						openWindowWithTitle('业绩查看', 'moneys.html');
					});
					$(".view_user").click(function() {
						localStorage.setItem('view_user_id', $(this).attr('view_user_id'))
						console.log($(this).attr('view_user_id'))
						openWindowWithTitle('业绩查看', 'moneys.html');
					});
					$('.avatar').attr('src', IP + '/' + data.user.avatar);
				}
			}

		});

		function SiteSearch(divTgs) {
			var str = $(divTgs).val();

			if(str == '') {
				//		weui.alert('请输入关键字');
				//		return;
			}

			localStorage.setItem('keywords', str)
			localStorage.setItem('page_index', 1)
			mescroll.resetUpScroll();

		}
		 
			mui.init({
			beforeback: function() {　　　
				var list = plus.webview.currentWebview().opener();　　
				mui.fire(list, 'update_tel_list');

			}
		});
	</script>

</html>