<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript" charset="utf-8" src="../js/mui.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/jquery/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="../js/jquery.qrcode.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/common.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/user.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/weixin.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/js_sdk20170302.js"></script>

		<script type="text/javascript" charset="utf-8" src="../js/idangerous.swiper-2.1.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/idangerous.swiper.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/base.css" />
		<link rel="stylesheet" href="../css/mescroll.min.css">
		<link rel="stylesheet" href="../css/mescroll-option.css">
		<script src="../js/mescroll-option.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mescroll.min.js" charset="utf-8"></script>
		<style>
			.gb_resItms li {
				width: 50%;
			}
			
			.mui-col-sm-3 {
				width: 33.33333333%;
			}
		</style>
	</head>

	<body  style="background: white;">
		<!--<div class="gb_res_t">
			<span>图片分享</span>
			<i></i>
		</div>-->
		<div id="mescroll" class="mui-slider mescroll" style="background: white;">
			<div class="mui-slider-group " id="" style="background: white;">

			</div>
			<div class="mui-slider-indicator" style="bottom: 0;display: none;">

			</div>
		</div>
		<!--<div class="gb_res_t"><span>链接分享</span>
			<i></i>
		</div>-->
		<!-- share  begin-->
		<div id="myModal" class="modal ">
			<!-- 弹窗内容 -->
			<div class="modal-content ">
				<div class="modal-header">
					<span class="close"></span>
				</div>
				<div class="gb_resLay">
					<div class="gb_res_t">
						<span>分享到</span>
						<i></i>
					</div>
					<div class="bdsharebuttonbox">
						<ul class="gb_resItms clearfix">
							<li>
								<a onclick="shareHref(1)" title="分享到微信" href="javascript:void(0);" class="bds_weixin" data-cmd="weixin"></a>
								微信好友
							</li>

							<li>
								<a onclick="shareHref(0)" title="分享到朋友圈" href="javascript:void(0);" class="bds_qzone" data-cmd="qzone"></a>
								朋友圈
							</li>

						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- share  end-->
		<script>
			mui.plusReady(function() {

				var wv = plus.webview.currentWebview();
				wv.setStyle({

					titleNView: {

						buttons: [{
							"float": "right",
							"fontSrc": "_www/fonts/mui.ttf", //wap2app内置字体文件
							"text": "\ue261",
							"onclick": "javascript:test()",
							"fontSize": '25px'
						}]
					}
				});

				// 获取弹窗
				var modal = document.getElementById('myModal');

				// 打开弹窗的按钮对象

				var btn = document.getElementById("myBtn");

				// 获取 <span> 元素，用于关闭弹窗 that closes the modal
				var span = document.getElementsByClassName("close")[0];

				// 点击 <span> (x), 关闭弹窗
				span.onclick = function() {
					modal.style.display = "none";
				}

				// 在用户点击其他地方时，关闭弹窗
				window.onclick = function(event) {
					if(event.target == modal) {
						modal.style.display = "none";
					}
				}

			});
			// 点击按钮打开弹窗
			function test() {
				var modal = document.getElementById('myModal');
				modal.style.display = "block";
			}
			mui.init();
			mui.ready(function() {
				localStorage.setItem('weixin_type', 'web');

			});
			mui.init({
				beforeback: function() {　　　

					localStorage.setItem('weixin_type', 'web');

				}
			});
		</script>
		<div id="mainBanner" class="main_banner" style="display: none;">

			<div id="slider" class="swiper-container">
				<div class="swiper-wrapper">

				</div>

			</div>
			<div class="pagination" style=""></div>
		</div>
		<div class="page-content pull-to-refresh-content" style="display: none;">

			<!-- 会员信息 -->
			<div class="content-block padding0 marginT0 height165">
				<div class="row no-gutter">
					<div class="col-100">
						<div class="my-bj">
							<div class="my-bj-2">
								<div class="radius my-radius-1"></div>
								<div class="radius my-radius-2"></div>
								<div class="radius my-radius-3"></div>
								<div class="radius my-radius-4"></div>
							</div>
							<div class="col-100 user-a">
								<div class="my-shezhi">
									<i class="icon iconfont icon-vip41 ca-color11 size-22 vip"></i>
								</div>
								<div class="user-name my-T my-TI user_name">王大花(9827)
								</div>
								<div class="user-phone my-TI user_id">13000000000</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 会员信息 end-->

			<!-- 条码二维码 -->
			<div class="content-block padding0 marginT0 height100f">
				<div class="row no-gutter marginT20 my-c-borderT">
					<div class="my-c-img" id="code" style="position: relative;">
						<img id="qrCodeIco" src="../images/logo.png" style="position: absolute;width: 50px; height: 50px;" /></div>
				</div>
			</div>
			<!-- 条码二维码 end-->
			<div class="am-text-center am-u-sm-11 am-u-sm-centered myapp-login-form-shortcut" style="margin-top:10PX">
				<hr class="myapp-login-form-hr">
				<span class="myapp-login-form-hr-font">分享</span>
			</div>

			<div class="am-u-sm-12 am-text-center myapp-login-form-listico">
				<div class="am-u-sm-4 am-text-center">
					<i class="am-icon-btn am-primary am-icon-qq" onclick="shareHref(2)"></i>
				</div>
				<div class="am-u-sm-4 am-text-center">
					<img src="../images/friend.png" width="65px" onclick="shareHref(0)" />
				</div>
				<div class="am-u-sm-4 am-text-center">
					<i class="am-icon-btn am-success am-icon-weixin" onclick="shareHref(1)"></i>
				</div>
			</div>
			<input id="sharehref" style="display: none;" class="sharehref" type="web" value="www.baidu.com" placeholder="请输入要分享的链接地址" />
			<input id="sharehrefTitle" style="display: none;" class="sharehref" type="text" value="加工详情" placeholder="请输入要分享的链接标题" />
			<input id="sharehrefDes" style="display: none;" class="sharehref" type="text" value="我正在使用HBuilder+HTML5开发移动应用，赶紧跟我一起体验！" placeholder="请输入要分享的链接描述" />
		</div>
	</body>
	<script type="text/javascript">
		$(document).ready(function() {

			var re_share_sub_title = localStorage.getItem('re_share_sub_title');
			var re_share_title = localStorage.getItem('re_share_title');
			var PreUrl = localStorage.getItem('PreUrl');
			var user = localStorage.getItem('user');
			user = JSON.parse(user);
			//alert(re_share_title) 
			$('#sharehref').val(PreUrl + 'Reg/register/rid/' + user.id);
			$('#sharehrefTitle').val(re_share_title);

			re_share_sub_title = re_share_sub_title.replace('{0}', user.user_name);

			$('#sharehrefDes').val(re_share_sub_title);
			$('#sharetype').val('web');
		});
	</script>
	<script type="text/javascript" charset="utf-8">
		//mui初始化

		$(function() {

			var PreUrl = localStorage.getItem('PreUrl');
			var IP = localStorage.getItem('IP');
			var AppUrl = localStorage.getItem('AppUrl');
			var width = $('body').width() * 0.55;
			var height = $('body').height() * 0.27;
			var host = window.location.host;
			var user = localStorage.getItem('user');
			user = JSON.parse(user);
			$('.user_id').html(user.user_id)
			$('.user_name').html(user.user_name)
			console.log(IP + user.avatar)
			$('.in-content-hd img').attr('src', IP + '/' + user.avatar)
			$('.in-header img').attr('src', IP + '/' + user.avatar)
			$('.vip').addClass('icon-vip' + user.u_level + '1')
			var url = PreUrl + 'Reg/register/rid/' + user.id
			$('#code').qrcode(url);
			var margin = ($("#code").height() - $("#qrCodeIco").height()) / 2;
			$("#qrCodeIco").css("margin", margin);
			var canvas = $('body').find('canvas').get(0);
			//			$('#imgOne').attr('src', canvas.toDataURL('image/jpg'))
			$('.in-pop').css('background', 'url(' + canvas.toDataURL('image/jpg') + ') no-repeat');
			$('.in-pop').css('background-size', '100%');

		});
	</script>

	<script type="text/javascript">
		//二维码弹窗
		function Ceng() {
			document.getElementById('ceng').style.display = 'block';
			document.getElementById('close').style.display = 'block';

			$('.in-pop').css('height', $('.in-pop').width())

			var height = ($(".in-pop").height())

			var margin = (height - $("#CodeIco").height()) / 2;
			$("#CodeIco").css("top", margin);
			$("#CodeIco").css("right", margin);

			return false;
		}

		function closeCeng() {
			document.getElementById('ceng').style.display = 'none';
			document.getElementById('close').style.display = 'none';
			return false;

		}
	</script>
	<script type="text/javascript">
		$(function() {
			
			
			$('#sliderSegmentedControl').css('display', 'none')
			var size = 10;
			var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
			mescroll = initMeScroll("mescroll", {
				down: {
					auto: true, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
					callback: downCallback //下拉刷新的回调
				},
				up: {
					auto: true, //是否在初始化时以上拉加载的方式自动加载第一页数据; 默认false
					isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
					callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page) { upCallback(page); }
					page: {
						num: 0, //当前页 默认0,回调之前会加1; 即callback(page)会从1开始
						size: size //每页数据条数,默认10
					},
					toTop: { //配置回到顶部按钮
						src: "../img/mescroll-totop.png"
					},
					htmlNodata: '<p class="upwarp-nodata">暂无数据</p>',
					noMoreSize: size,
					lazyLoad: {
						use: true, // 是否开启懒加载,默认false
						attr: 'imgurl', // 网络地址的属性名 (图片加载成功会移除该属性): <img imgurl='网络图  src='占位图''/>
						showClass: 'mescroll-lazy-in', // 图片加载成功的显示动画: 渐变显示,参见mescroll.css
						delay: 100, // 列表滚动的过程中每500ms检查一次图片是否在可视区域,如果在可视区域则加载图片
						offset: 200 // 超出可视区域200px的图片仍可触发懒加载,目的是提前加载部分图片
					}
				}
			});

			function getListDataFromNet(pageNum, pageSize, successCallback, errorCallback) {
				//延时一秒,模拟联网

				try {

					get_user_list(pageNum, pageSize, successCallback)
				} catch(e) {
					//联网失败的回调
					errorCallback && errorCallback();
				}

			}
			var page_index = 0;
			localStorage.setItem('page_index', page_index);
			/*下拉刷新的回调 */
			function downCallback() {
				var page_index = 0;
				$('.detail-list ul li').remove()

				//					page_index = parseInt(page_index) + 1;
				localStorage.setItem('page_index', page_index);

				var user_id = localStorage.getItem('user_id');
				//联网加载数据
				getListDataFromNet(page_index, size, function(data) {
					//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
					//mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据; 

					var ListData = localStorage.getItem('ListData');

					var data = JSON.parse(ListData);
					//			mescroll.endBySize(list_count, total_count);
					//方法一(推荐): 后台接口有返回列表的总页数 totalPage
					//mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

					//方法二(推荐): 后台接口有返回列表的总数据量 totalSize
					//						 mescroll.endBySize(data.data.length, data.count); //必传参数(当前页的数据个数, 总数据量)

					//方法三(推荐): 您有其他方式知道是否有下一页 hasNext
					//mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

					//方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.

					mescroll.endSuccess(data.current_count);

					//提示:curPageData.length必传的原因:
					// 1.判断是否有下一页的首要依据: 当传的值小于page.size时,则一定会认为无更多数据.
					// 2.比传入的totalPage, totalSize, hasNext具有更高的判断优先级
					// 3.使配置的noMoreSize生效

					//设置列表数据
					var curPageData = localStorage.getItem('ListData');

					setListData(curPageData, true);
				}, function() {
					//联网失败的回调,隐藏下拉刷新的状态
					mescroll.endErr();
				});
			}
			/*上拉加载的回调 */
			function upCallback(page) {
				var page_index = page.num;
				//					page_index = parseInt(page_index) + 1;
				localStorage.setItem('page_index', page_index);
				//					page_index = localStorage.getItem('page_index');
				//联网加载数据
				getListDataFromNet(page_index, page.size, function(curPageData) {
					//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
					//mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据; 

					var ListData = localStorage.getItem('ListData');

					var data = JSON.parse(ListData);
					//			mescroll.endBySize(list_count, total_count);
					//方法一(推荐): 后台接口有返回列表的总页数 totalPage
					//mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

					//方法二(推荐): 后台接口有返回列表的总数据量 totalSize
					//						 mescroll.endBySize(data.data.length, data.count); //必传参数(当前页的数据个数, 总数据量)

					//方法三(推荐): 您有其他方式知道是否有下一页 hasNext
					//mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

					//方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.

					mescroll.endSuccess(data.current_count);

					//提示:curPageData.length必传的原因:
					// 1.判断是否有下一页的首要依据: 当传的值小于page.size时,则一定会认为无更多数据.
					// 2.比传入的totalPage, totalSize, hasNext具有更高的判断优先级
					// 3.使配置的noMoreSize生效

					//设置列表数据
					var curPageData = localStorage.getItem('ListData');

					setListData(curPageData, true);
				}, function() {
					//联网失败的回调,隐藏下拉刷新和上拉加载的状态;
					mescroll.endErr();
				});
			}

			function setListData(data) { 
				info = JSON.parse(data);
				user = info.user;
				info = info.recommend_images_list;
				var IP = localStorage.getItem('IP');
				if(info != null) {
					var item = '';
					$.each(info, function(index, content) {
						var item = '	 <div class="swiper-slide"> ';
						item += '<a href="javascript:void(0)">	<img src="' + IP + content.image_url + '"  style="height:500px"/></a> </div>';

						$('.swiper-wrapper').append(item);

					});
					var mySwiper = new Swiper('.swiper-container', {
						calculateHeight: true,
						resizeReInit: true,
						pagination: ".pagination",
						autoplay: 5000,
						paginationClickable: true,
						autoplayDisableOnInteraction: false
					});

					$('.mui-slider-group .mui-slider-item').remove();
					var li_count = 1000;
					var count = parseInt(info.length / li_count) + 1;

					for(var i = 0; i < count; i++) {
						var item = '	<div class="mui-slider-item"  >';
						item += '    <ul class="mui-table-view mui-grid-view mui-grid-9"style="background: white;">';
						$.each(info, function(index, content) {
							if(index < li_count * (i + 1) && index >= i * li_count) {
								item += '	<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">';
								item += '		<a href="#">';
								console.log(IP + content.image_url)
								item += '		<img imgurl="' + IP + content.image_url + '"  src="../images/loading.png"  style="height:150px"/>';
								item += '	<div class="mui-media-body" style="display:none" >' + content.txt + '</div>';
								item += '	</a>';
								item += '		</li>';
							}
						});
						item += '	</ul>';
						item += '	</div>';
						$('.mui-slider-group').append(item);
					}

					$('.mui-slider-indicator .mui-indicator').remove();
					for(var i = 0; i < count; i++) {
						var active = '';
						if(i == 0) {
							active = 'mui-active';
						}
						var item = '<div class="mui-indicator ' + active + '"></div>';
						$('.mui-slider-indicator').append(item);

					}
					$(".mui-slider-group .mui-media").on("click", function() {
						localStorage.setItem('recommend_images', $(this).find('img').attr('src'))
						//						localStorage.setItem('is_login', 1)
						openWindowWithTitle('分享', 'recommend_detail.html')
					});
					var slider = document.getElementById('Gallery');
					var group = slider.querySelector('.mui-slider-group');
					var items = mui('.mui-slider-item', group);
					//克隆第一个节点
					var first = items[0].cloneNode(true);
					first.classList.add('mui-slider-item-duplicate');
					//克隆最后一个节点
					var last = items[items.length - 1].cloneNode(true);
					last.classList.add('mui-slider-item-duplicate');
					//处理是否循环逻辑，若支持循环，需支持两点：
					//1、在.mui-slider-group节点上增加.mui-slider-loop类
					//2、重复增加2个循环节点，图片顺序变为：N、1、2...N、1
					var sliderApi = mui(slider).slider();

					function toggleLoop(loop) {
						if(loop) {
							group.classList.add('mui-slider-loop');
							group.insertBefore(last, group.firstChild);
							group.appendChild(first);
							sliderApi.refresh();
							sliderApi.gotoItem(0);
						} else {
							group.classList.remove('mui-slider-loop');
							group.removeChild(first);
							group.removeChild(last);
							sliderApi.refresh();
							sliderApi.gotoItem(0);
						}
					}
					//按下“循环”按钮的处理逻辑；
					document.getElementById('Gallery_Toggle').addEventListener('toggle', function(e) {
						var loop = e.detail.isActive;
						toggleLoop(loop);
					});

				}

			}

			 
			
//
//			var size = 10;
//			var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
//			var mescroll = initMeScroll("mescroll", {
//				down: {
//					auto: true, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
//					callback: downCallback //下拉刷新的回调
//				},
//				up: {
//					callback: upCallback,
//					lazyLoad: {
//						use: true ,
//						attr: 'imgurl' 
//					}
//				}
//			});
//
//			function getListDataFromNet(pageNum, pageSize, successCallback, errorCallback) {
//				//延时一秒,模拟联网
//
//				try {
//					get_user_list(pageNum, pageSize, successCallback)
//				} catch(e) {
//					//联网失败的回调
//					errorCallback && errorCallback();
//				}
//
//			}
//			var page_index = 0;
//			localStorage.setItem('page_index', page_index);
//			/*下拉刷新的回调 */
//			function downCallback() {
//				var page_index = 0;
//				$('.user_list div').remove()
//
//				//					page_index = parseInt(page_index) + 1;
//				localStorage.setItem('page_index', page_index);
//
//				var user_id = localStorage.getItem('user_id');
//				//联网加载数据 
//				getListDataFromNet(page_index, size, function(data) {
//					//联网成功的回调,隐藏下拉刷新的状态
//					mescroll.endSuccess();
//					var curPageData = localStorage.getItem('ListData');
//					//设置列表数据
//					setListData(curPageData);
//					//			down();
//				}, function() {
//					//联网失败的回调,隐藏下拉刷新的状态
//					mescroll.endErr();
//				});
//			}
//
//			function setListData(data) {}

		});
	</script>

</html>