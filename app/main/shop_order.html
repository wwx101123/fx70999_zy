<!DOCTYPE html>
<!--HTML5 doctype-->
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<title>我的订单 </title>
		<meta name="keywords" content="{site.seo_keyword}" />
		<meta name="description" content="{site.seo_description}" />
		<link href="../css/style(2).css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<script type="text/javascript" charset="utf-8" src="../js/jquery/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/mui.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/common.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/seller.js"></script>
		<link rel="stylesheet" href="../css/mescroll.min.css">
		<link rel="stylesheet" href="../css/mescroll-option.css">
		<script src="../js/mescroll-option.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mescroll.min.js" charset="utf-8"></script>
		<script type="text/javascript">
			mui.plusReady(function() {
				$('.mui-control-item1').css('width', '20%');

			});
		</script>
		<style>
			.weui-cell:before {
				border-top: 0PX;
			}
			
			.time-item {
				float: left;
				margin-top: 3px;
			}
			
			.time-item strong {
				background: #ef1544;
				color: #fff;
				/* line-height: 49px; */
				font-size: 15px;
				font-family: Arial;
				padding: 0 5px;
				margin-right: 2px;
				float: left;
				border-radius: 5px;
				box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
			}
			
			#day_show {
				float: left;
				line-height: 49px;
				color: #c71c60;
				font-size: 32px;
				margin: 0 10px;
				font-family: Arial, Helvetica, sans-serif;
			}
			
			.item-title .unit {
				background: none;
				line-height: 49px;
				font-size: 24px;
				padding: 0 10px;
				float: left;
			}
		</style>
		<style>
			.images {
				background: white;
				width: 100%;
				height: 70px;
			}
			
			.images .item {
				float: left;
				height: 70px;
				width: 50%;
				text-align: center;
			}
			
			.images img {
				HEIGHT: 70px;
			}
			
			.zfb {
				width: 50%;
				float: left;
				text-align: center;
				background: white;
				font-size: 10px;
			}
			
			.wx {
				width: 50%;
				float: left;
				text-align: center;
				background: white;
				font-size: 10px;
			}
		</style>
	</head>

	<body ontouchstart>

		<!--页面头部-->

		<!--/页面头部-->

		<div class="page__bd mescroll" id="mescroll" style="margin-top: 5px;">

			<!--订单列表-->
			<div class="detail-list">
				<ul>
					<!--取得一个DataTable-->

					<div class="nodata" style="display: none;">暂无记录...</div>

				</ul>
			</div>

			<!--分页页码-->
			<div class=" tab-panel">
				<div class="tab-panel-item tab-active"></div>
			</div>
			<!--/分页页码-->

			<input id="turl" type="hidden" value="useraddress.html" />
			<!--存在跳转的URL值-->
			<!--/订单列表-->

			<!--版权信息-->
			<!--/版权信息-->

			<!--底部导航-->

			<!--/底部导航-->
		</div>
	</body>
	<script type="text/javascript">
		//		function init() {
		//			mui.init({
		//				pullRefresh: {
		//					container: '.page__bd',
		//					down: {
		//						style: 'circle',
		//						color: localStorage.getItem('color'),
		//						auto: true,
		//						callback: down
		//					}
		//				}
		//			});
		//
		//		}

		//		function down() {
		//
		//			shop_order_list();
		//
		//			$('.page__bd').css('padding-top', 0)
		//
		//			mui('.page__bd').pullRefresh().endPulldown();
		//		}
	</script>

	<script>
		var size = 10;
		var mescroll = initMeScroll("mescroll", {
			down: {
				auto: false, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
				callback: downCallback //下拉刷新的回调
			},
			up: {
				auto: true, //是否在初始化时以上拉加载的方式自动加载第一页数据; 默认false
				isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
				callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page) { upCallback(page); }
				page: {
					num: 0, //当前页 默认0,回调之前会加1; 即callback(page)会从1开始
					size: size //每页数据条数,默认10
				},
				toTop: { //配置回到顶部按钮
					src: "../img/mescroll-totop.png"
				},
				htmlNodata: '<p class="upwarp-nodata">暂无数据</p>',
				noMoreSize: size
			}
		});

		function getListDataFromNet(pageNum, pageSize, successCallback, errorCallback) {
			//延时一秒,模拟联网

			try {

				shop_order_list(pageNum, pageSize, successCallback);
			} catch(e) {
				//联网失败的回调
				errorCallback && errorCallback();
			}

		}
		var page_index = 0;
		localStorage.setItem('page_index', page_index);
		/*下拉刷新的回调 */
		function downCallback() {
			var page_index = 0;
			$('.my_cate li').remove()
			$('.goods_list .goods_item').remove()
			$('.tab-panel-item ul').remove();

			//					page_index = parseInt(page_index) + 1;
			localStorage.setItem('page_index', page_index);

			//联网加载数据
			getListDataFromNet(page_index, size, function(data) {
				//联网成功的回调,隐藏下拉刷新的状态

				var curPageData = localStorage.getItem('ListData');
				var data = JSON.parse(curPageData);
				mescroll.endSuccess(data.current_count);
				//设置列表数据
				setListData(curPageData);
				//			down();
			}, function() {
				//联网失败的回调,隐藏下拉刷新的状态
				mescroll.endErr();
			});
		}

		/*上拉加载的回调 */
		function upCallback(page) {
			var page_index = page.num;
			//					page_index = parseInt(page_index) + 1;
			localStorage.setItem('page_index', page_index);
			//					page_index = localStorage.getItem('page_index');
			//联网加载数据
			getListDataFromNet(page_index, page.size, function(curPageData) {
				//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
				//mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据; 

				var ListData = localStorage.getItem('ListData');

				var data = JSON.parse(ListData);
				//			mescroll.endBySize(list_count, total_count);
				//方法一(推荐): 后台接口有返回列表的总页数 totalPage
				//mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

				//方法二(推荐): 后台接口有返回列表的总数据量 totalSize
				//						 mescroll.endBySize(data.data.length, data.count); //必传参数(当前页的数据个数, 总数据量)

				//方法三(推荐): 您有其他方式知道是否有下一页 hasNext
				//mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

				//方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.

				mescroll.endSuccess(data.current_count);

				//提示:curPageData.length必传的原因:
				// 1.判断是否有下一页的首要依据: 当传的值小于page.size时,则一定会认为无更多数据.
				// 2.比传入的totalPage, totalSize, hasNext具有更高的判断优先级
				// 3.使配置的noMoreSize生效

				//设置列表数据
				var curPageData = localStorage.getItem('ListData');

				setListData(curPageData, true);
			}, function() {
				//联网失败的回调,隐藏下拉刷新和上拉加载的状态;
				mescroll.endErr();
			});
		}

		function setListData(data) {
			$('.nodata').css('display', 'none');
			data = JSON.parse(data);
			var status = data.status;
			if(status == 1) {
				var info = data.data;
				if(info == null) {
					$('.nodata').css('display', 'block');
				}
				var page_index = localStorage.getItem('page_index');
				if(page_index == 1) {

					$('.tab-panel-item ul').remove();
				}
				if(info != null) {

					var item = '';
					$.each(info, function(index1, content1) {

						item += '	<ul seller_no="' + content1.shop_id + '" class="mui-table-view" style="margin-left: 15px; margin-right: 15px;margin-top: 15px;">';
						item += '	<li class="mui-table-view-cell day_time" style="    FONT-SIZE: 20PX;">';

						item += '	<div class="mui-media-body"><span class="mui-ellipsis" style="font-size: 15px; color: #8f8f94; ">' + content1.trade_time_str + '</span>';
						item += '		<span src="../images/logo.png" style="float: right;" >' + content1.trade_money + '</span>';
						item += '	</div>';

						item += '	</li>';
						item += '	<li class="mui-table-view-cell day_time" style="    FONT-SIZE: 20PX;">';
						item += '	<a class=""><span class="mui-pull-right" style="line-height: 40px; font-size: 18px; color: black; margin-right: 20PX; "></span>';
						item += '		<div class="mui-media-body"><span class="mui-ellipsis" style="font-size: 18px; color: black; ">' + content1.shop_name + '</span>';
						//						item += '		<p class="mui-ellipsis" style="font-size: 12px; color: #8f8f94; ">交易量:' + content1.trade_money + '</p>';
						item += '	</div>';
						item += '		</a>';
						item += '	</li>';

						item += '	</ul>';

					});
					$('.tab-panel-item').append(item);

					//					$(".open").on('click', function() {
					//						var display = $(this).parent().parent().parent().parent().find('ul').css('display');
					//
					//						if(display == 'block') {
					//							$(this).html('打开')
					//							$(this).parent().parent().parent().parent().find('ul').css('display', 'none')
					//						} else {
					//
					//							$(this).html('收起')
					//							$(this).parent().parent().parent().parent().find('ul').css('display', 'block')
					//						}
					//
					//					}) 
				}
			}
		}
	</script>

</html>