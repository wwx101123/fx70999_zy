<!DOCTYPE html>
<!--HTML5 doctype-->
<html style="height: 100%;">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<title>购物商城 </title>
		<meta name="keywords" content="{site.seo_keyword}" />
		<meta name="description" content="{site.seo_description}" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/login.css" />
		<script type="text/javascript" charset="utf-8" src="js/zepto.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/mvalidate.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/mvalidate-extend.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/mui.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/common.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/user.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/base.js"></script>
		<style>
			.reg label {
				margin-top: 0PX;
				color: #4c2664;
			}
			
			.am-form-icon {
				height: 60px;
				line-height: 60px;
			}
		</style>
		<script type="text/javascript">
			//mui初始化 
			mui.init({
				statusBarBackground: '#E44864'
			});

			var aniShow = {};
			var activeTab = '';
			var titleEL = document.querySelector('.mui-title');
			var mainWv;
			var _self;
			//创建子页面，首个选项卡页面显示，其它均隐藏；
			mui.plusReady(function() {
				localStorage.setItem('check_password2',0)
				localStorage.setItem('head_height', 50)
				localStorage.setItem('is_login', 1)
				$('body').css('display', 'none')
				localStorage.setItem('user_login', 0)
				if(mui.os.ios) {
					localStorage.setItem('os', 'ios')
				} else {
					localStorage.setItem('os', 'android')
				}
				var os = localStorage.getItem('os')
				$('#app_os').val(os)

				var user_id = localStorage.getItem('user_id');
				var user = localStorage.getItem('user');

				if(user_id == null || user_id == 0 || user == 'undefined') {
					localStorage.setItem('user_login', 1)
					$('body').css('display', 'block')
					$('body').css('height', '100%')

				} else if(user_id > 0) {
					var user = localStorage.getItem('user');
					//					mui.toast('开始登陆')

					user = JSON.parse(user);

					if(user.user_id == '') {

					} else {
						localStorage.setItem('autoBackButton', false)
						openWindowWithTitle('首页', 'index.html')

					}
				} else {
					localStorage.setItem('autoBackButton', false)
					openWindowWithTitle('首页', 'index.html')
					//					location.href = 'main/index.html'
				}

				localStorage.setItem('color', '#E44864')
				localStorage.setItem('StatusbarHeight', plus.navigator.getStatusbarHeight())

				//读取本地存储，检查是否为首次启动
				var showGuide = plus.storage.getItem("lauchFlag");
				//仅支持竖屏显示
				plus.screen.lockOrientation("portrait-primary");
				if(true) {
					//有值，说明已经显示过了，无需显示；
					//关闭splash页面；
					plus.navigator.closeSplashscreen();
					plus.navigator.setFullscreen(false);
					//预加载

				}

				//绘制顶部图标
				_self = plus.webview.currentWebview();
				var titleView = _self.getNavigationbar();

				if(!titleView) {
					titleView = plus.webview.getLaunchWebview().getNavigationbar();

				}

				//				titleView.drawRect("#03a9f4", {
				//					top: "43px",
				//					height: "1px",
				//					left: "0px"
				//				}); //绘制底部边线

				//开启回弹
				_self.setStyle({
					bounce: "vertical",
					bounceBackground: "#efeff4",
					popGesture: 'none' //首页有侧滑菜单，因此屏蔽首页的侧滑关闭功能
				});

				mainWv = plus.webview.currentWebview();
				var titleEL = document.querySelector('.mui-title');

				// 默认只加载首页webview

				localStorage.setItem('user_login', '1')
				plus.runtime.setBadgeNumber(0);

				$('#forgetPwd').click(function() {
					localStorage.setItem('autoBackButton', true)
					localStorage.setItem('is_login', 0)

					openWindowWithTitle('忘记密码', 'main/forget_password.html')

				})

				$('#btnRegister').click(function() {

					localStorage.setItem('autoBackButton', true)
					localStorage.setItem('is_login', 0)
					openWindowWithTitle('注册', 'main/register.html')

				})

			});
			var jinzhi = 0;
			document.addEventListener("touchmove", function(e) {
				if(jinzhi == 0) {
					e.preventDefault();
					e.stopPropagation();
				}
			}, false);
			mui.plusReady(function() {
				var ServerIP = "";
				var IP = localStorage.getItem('IP');
				var PreUrl = localStorage.getItem('PreUrl');
				var UploadUrl = localStorage.getItem('UploadUrl');
				/**
				 * 获取商品列表
				 */
				var get_parameter_val = PreUrl + "YouZi/setParameter";
				//				console.log(get_parameter_val)
				$.ajax({
					url: get_parameter_val,
					data: {
						is_mobile: 1
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'POST', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；

					success: function(data) {
						//						mui.toast(222)
						var status = data.status;
						if(status == 1) {
							var info = data.data;

							localStorage.setItem('check_status', info.check_status);

							var check_status = localStorage.getItem('check_status')
							if(check_status == 1) {
								location.href = 'main/shop_index.html'
							} else {
								var user_id = localStorage.getItem('user_id');
								if(user_id == null || user_id == 0) {
									localStorage.setItem('user_login', 1)
									//									$('body').css('display', 'block')
								} else {
									localStorage.setItem('user_login', 0)

									//									location.href = 'main/index.html'
								}
							}

						}

					},
					error: function(xhr, type, errorThrown) {
						//异常处理；
						console.log(JSON.stringify(xhr));
					}
				});

			});
		</script>
		<script type="text/javascript">
			$(function() {
				localStorage.setItem('user_login', '1');
				var ServerIP = "";
				var IP = localStorage.getItem('IP');
				var PreUrl = localStorage.getItem('PreUrl');
				/**
				 * 登录
				 */
				var checkLogin = PreUrl + "Public/checkLogin";
				//				console.log(checkLogin)
				$('#loginForm').attr('url', checkLogin);
				localStorage.setItem('is_login', 1)
				AjaxInitForm('#loginForm', '#btnSubmit', 0, '#turl');

			});
			window.addEventListener('ready_login', function(e) {
				localStorage.setItem('is_login', 1)
				var user = localStorage.getItem('user');
				if(user != null) {
					user = JSON.parse(user);
					console.log(user.user_id)
					$('#username').val(user.user_id);
					$('#password').val(user.pwd1);
					$("#btnSubmit").trigger("click");
				}

			});
		</script>

	</head>

	<body style="background: #fff;padding-top: 20%;">
		<section class="aui-flexView">

			<form id="loginForm" class="am-form">
				<input type="hidden" id="is_mobile" name="is_mobile" value="1">
				<section class="aui-scrollView">
					<div class="aui-entry-box">
						<div class="aui-entry-head">
							<div class="aui-entry-img">
								<img src="images/head-title.png" alt="">
							</div>
							<div class="aui-flex-item">
								<div class="aui-flex b-line">
									<div class="aui-flex-icon">
										<img src="images/icon-user.png" alt="">
									</div>
									<div class="aui-flex-box">
										<input type="text" placeholder="用户名" name="username">
									</div>
								</div>
								<div class="aui-flex">
									<div class="aui-flex-icon">
										<img src="images/icon-psd.png" alt="">
									</div>
									<div class="aui-flex-box">
										<input type="password" placeholder="密码" name="password">
									</div>
								</div>
							</div>
							<div class="aui-entry-button">
								<button>登录</button>
							</div>
							<div class="aui-entry-forget">
							</div>
						</div>
						<div class="reg">
							<label id="forgetPwd">忘记密码?</label>
							<label style="float: right;" id="btnRegister">注册新用户</label>

						</div>
						<!-- <div class="aui-entry-text">
                        <p>第三方快速登录</p>
                    </div>
                    <div class="aui-entry-signs">
                        <button> <i class="icon icon-wx"></i> 微信</button>
                        <button style="color:#38a9d3"><i class="icon icon-qq"></i>QQ</button>
                    </div>-->
					</div>
				</section>
			</form>
		</section>

	</body>

	<script type="text/javascript">
		mui.plusReady(function() {

			if(navigator.userAgent.toLowerCase().indexOf("chrome") >= 0) {

				$(window).load(function() {

					$('ul input:not(input[type=submit])').each(function() {

						var outHtml = this.outerHTML;

						$(this).append(outHtml);

					});

				});

			}

		});

		function changeverify() {

			$('#imgverify').attr('src', "{:U('Public/verify')}?" + Math.random(1, 1000))

		}

		function download(ios_url, app_url) {

			var sUserAgent = navigator.userAgent.toLowerCase();
			var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
			var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
			var bIsMidp = sUserAgent.match(/midp/i) == "midp";
			var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
			var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
			var bIsAndroid = sUserAgent.match(/android/i) == "android";
			var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
			var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
			if(bIsIpad || bIsIphoneOs) {

				setTimeout(function() {
					location.href = ios_url
				}, 1000);

				return;
			}
			if(bIsAndroid) {

				setTimeout(function() {
					location.href = app_url
				}, 1000);

				return;
			}

		}
	</script>

</html>