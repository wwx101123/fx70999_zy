
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>编辑后台导航</title>
<meta name="viewport"
	content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" type="text/css"
	href="__PUBLIC__/scripts/artdialog/ui-dialog.css" />
<link rel="stylesheet" type="text/css"
	href="__PUBLIC__/Adm/skin/icon/iconfont.css" />
<link rel="stylesheet" type="text/css"
	href="__PUBLIC__/Adm/skin/default/style.css" />
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/scripts/jquery/jquery-1.11.2.min.js"></script>
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/scripts/jquery/jquery.nicescroll.js"></script>
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/scripts/artdialog/dialog-plus-min.js"></script>
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/Adm/js/layindex.js"></script>
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/Adm/js/laymain.js"></script>
<script type="text/javascript" charset="utf-8"
	src="__PUBLIC__/Adm/js/common.js"></script>
<link href="__PUBLIC__/Adm/css/main.css" rel="stylesheet">
	
<script type="text/javascript" src="__PUBLIC__/Adm/js/global.js"></script>
	<link rel="stylesheet" type="text/css"
	href="__PUBLIC__/Adm/skin/icon/iconfont.css" />
<link href="__PUBLIC__/Adm/Resource/style.css" rel="stylesheet">
<link href="__PUBLIC__/Adm/css/main.css" rel="stylesheet">
<script type="text/javascript" src="__PUBLIC__/Adm/layui/layui.js"></script>
<script type="text/javascript">
layui.use('layer', function() {

});
</script>
<link
	href="__PUBLIC__/Adm/Resource/plugins/hplus/css/font-awesome.min.css"
	rel="stylesheet">
<script type="text/javascript">
	$(function() {
		//初始化表单验证
		/* $("#form1").initValidform();
		//初始化上传控件
		$(".upload-img").InitUploader({
			sendurl : "../../tools/upload_ajax.ashx",
			swf : "../../scripts/webuploader/uploader.swf"
		}); */
	});
</script>
</head>

<body class="mainbody">
	<form class="form-horizontal ajax-post" name="form1" id="form1"
		method="post" action="__ACTION__">

		<input type="hidden" name="id" id="id" value="{$vo.id}">
		<!--导航栏-->
		<div class="location"></div>
		<div class="line10"></div>
		<!--/导航栏-->

		<!--内容-->
		<div id="floatHead" class="content-tab-wrap">
			<div class="content-tab">
				<div class="content-tab-ul-wrap">
					<ul>
						<li><a class="selected" href="javascript:;">基本信息</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="tab-content">

			<dl>
				<dt>类别名称</dt>
				<dd>
					<input name="title" type="text" value="{$vo.title}"
						class="input normal" required="">
				</dd>
			</dl>
<dl>
				<dt>副标题</dt>
				<dd>
					<input name="seo_title" type="text" value="{$vo.seo_title}"
						class="input normal" required="">
				</dd>
			</dl>

			<dl>
				<dt>所属类别</dt>
				<dd>
					<div class="rule-single-select">

						<select name="ddlParentId" id="ddlParentId" class="input normal">
							<volist name="category" id="vvo" key="i"> <eq
								name="vo.parent_id" value="$vvo.id">
							<option value="{$vvo.id}" selected>{$vvo.title}</option>
							<else />
							<option value="{$vvo.id}">{$vvo.title}</option>
							</eq> </volist>
						</select>

					</div>
				</dd>
			</dl>
			<dl>
				<dt>排序数字：</dt>
				<dd>
					<input name="sort_id" type="text" value="{$vo.sort_id}"
						class="input normal" required="">
				</dd>
			</dl>
			<dl>
				<dt>图片上传</dt>
				<dd>
					<div class="input-file-show">
						<span class="show"> <a id="img_a" target="_blank"
							class="nyroModal" rel="gal" href="{$vo.img_url}"> <i
								id="img_i" class="fa fa-picture-o"
								onMouseOver="layer.tips('<img src={$vo.img_url}>',this,{tips: [1, '#fff']});"
								onMouseOut="layer.closeAll();"></i>
						</a>
						</span> <span class="type-file-box"> <input type="text"
							id="imagetext" name="img" value="{$vo.img_url}"
							class="type-file-text"> <input type="button"
							name="button" id="button1" value="点击上传" class="type-file-button">
							<input class="type-file-file"
							onClick="GetUploadify(1,'','goods','img_call_back')" size="30"
							title="点击前方预览图可查看大图，点击按钮选择文件并提交表单后上传生效">
						</span>
					</div>
					<span class="err"></span>

					<p class="notic">请上传图片格式文件</p>
				</dd>
			</dl>
			<dl>
				<dt>分类滚动图</dt>
				<dd>
					<div class="tab-pane" id="tab_goods_images">
						<table class="table table-bordered">
							<tbody>
								<tr>
									<td><volist name="slide_list" id="image">
										<div
											style="width: 100px; text-align: center; margin: 5px; display: inline-block;"
											class="goods_xc2">
											<input type="hidden" value="{$image['image_url']}"
												name="goods_images2[]"> <a onClick=""
												href="{$image['image_url']}" target="_blank"><img
												width="100" height="100" src="{$image['image_url']}"></a>
											<br> <a href="javascript:void(0)"
												onClick="ClearPicArr2(this,'{$image.image_url}')">删除</a>
										</div>
										</volist>

										<div class="goods_xc2"
											style="width: 100px; text-align: center; margin: 5px; display: inline-block;">
											<input type="hidden" name="goods_images2[]" value="" /> <a
												href="javascript:void(0);"
												onClick="GetUploadify(5,'','goods','call_back3');"><img
												src="__PUBLIC__/images/add-button.jpg" width="100"
												height="100" /></a> <br /> <a href="javascript:void(0)">&nbsp;&nbsp;</a>
										</div></td>
								</tr>
							</tbody>
						</table>
					</div>
				</dd>
			</dl>

		</div>

		<!--/内容-->

		<!--工具栏-->
		<div class="page-footer">
			<div class="btn-wrap">
				<input name="btnSubmit" type="submit" value="提交保存" class="btn "
					onclick="btnSubmit_Click" /> <input name="btnReturn" type="button"
					value="返回上一页" class="btn yellow"
					onclick="javascript:history.back(-1);" />
			</div>
		</div>
		<!--/工具栏-->
	</form>
	<script>
		$(function() {
			$("#checkbox").change(function() {
				if ($('#checkbox').is(':checked')) {
					$('#type').val(1);
				} else {
					$('#type').val(0);
				}
			});
		});

		layui.use([ 'layedit', 'upload', 'layer', 'laydate' ], function() {
			var layedit = layui.layedit;
			var layer = layui.layer;
			layedit.set({
				uploadImage : {
					url : '__APP__/Gouwu/upload_layedit_pp'
				}
			});
			edit = layedit.build('demo'); //建立编辑器
			$('.ajax-submit').on('click', function() {
				$('#cate_detail').val(layedit.getContent(edit));
			});
			$('.ajax-submit').on('click', function() {
				$('#cate_detail').val(layedit.getContent(edit));
				form = $('.ajax-form');
				$.post(form.attr('action'), form.serialize(), function(data) {
					// console.log(data);
					if (data.status) {
						layer.msg(data.info, {
							offset : '100px',
							end : function() {
								if (data.url) {
									location.href = data.url;
								} else {
									location.reload();
								}
							}
						});
					} else {

						layer.msg(data.info);
					}
				});
				return false;
			});
		});
		//上传图片回调事件
		function img_call_back(fileurl_tmp) {
			$("#imagetext").val(fileurl_tmp);
			$("#img_a").attr('href', fileurl_tmp);
			$("#img_i")
					.attr('onmouseover',
							"layer.tips('<img src=" + fileurl_tmp + ">',this,{tips: [1, '#fff']});");
		}
		// 上传商品图片成功回调函数
		function call_back3(paths) {
			var last_div = $(".goods_xc2:last").prop("outerHTML");
			for (var i = 0; i < paths.length; i++) {
				$(".goods_xc2:eq(0)").before(last_div); // 插入一个 新图片
				$(".goods_xc2:eq(0)").find('a:eq(0)').attr('href', paths[i])
						.attr('onclick', '').attr('target', "_blank");// 修改他的链接地址
				$(".goods_xc2:eq(0)").find('img').attr('src', paths[i]);// 修改他的图片路径
				$(".goods_xc2:eq(0)").find('a:eq(1)').attr('onclick',
						"ClearPicArr2(this,'" + paths[i] + "')").text('删除');
				$(".goods_xc2:eq(0)").find('input').val(paths[i]); // 设置隐藏域 要提交的值
			}
		}
		//上传之后删除组图
		function ClearPicArr2(obj, path) {
			$.ajax({
				type : 'GET',
				url : "{:U('Uploadify/delupload')}",
				data : {
					action : "del",
					filename : path
				},
				success : function() {
					$(obj).parent().remove(); // 删除完服务器的, 再删除 html上的图片
				}
			});
			// 删除数据库记录
			$.ajax({
				type : 'GET',
				url : "{:U('Uploadify/del_goods_images')}",
				data : {
					filename : path
				},
				success : function() {
				}
			});
		}
	</script>
</body>
</html>

