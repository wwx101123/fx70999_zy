<extend name="Public:header" />
<block name="breadcrumb">
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>积分转帐</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="{:U('Index/index')}">首页</a>
                </li>
                <li>
                    <a>财务管理</a>
                </li>
                <li class="active">
                    <strong>积分转账</strong>
                </li>
            </ol>
        </div>
    </div>
</block>

<block name="menu">
    <div class="wrapper wrapper-content animated fadeInRight">


        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>转帐记录 </h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <form class="form-inline title-form" name="form2" method="post"
                            action="?action1=query">
                            <div class="form-group" id="data_5">
                                <label class="font-noraml"></label>
                                <div class="input-daterange input-group" id="datepicker">
                                    <input type="text" class="form-control" name="time1"
                                    placeholder="开始日期" id="time1" value="<notempty name='time1'>{$time1}</notempty>">
                                    <span class="input-group-addon">到</span>
                                    <input type="text" class="form-control" name="time2"
                                    placeholder="截止日期" id="time2" value="<notempty name='time2'>{$time2}</notempty>">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">查询</button>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">我要转账</button>
                        </form>
                    </div>
                            <script type="text/javascript">
                                layui.use('laydate', function(){
                                  var laydate = layui.laydate;
                                      var start = {
                                      // min: laydate.now(-2)
                                      max: '2099-06-16 23:59:59'
                                      ,istoday: false
                                      ,choose: function(datas){
                                        end.min = datas; //开始日选好后，重置结束日的最小日期
                                        end.start = datas //将结束日的初始值设定为开始日
                                      }
                                    };
                                    
                                    var end = {
                                      min: laydate.now()
                                      ,max: '2099-06-16 23:59:59'
                                      ,istoday: false
                                      ,choose: function(datas){
                                        start.max = datas; //结束日选好后，重置开始日的最大日期
                                      }
                                    };
                                    
                                    $('#time1').on('click',function(){
                                      start.elem = this;
                                      laydate(start);
                                    });
                                    $('#time2').on('click',function(){
                                      end.elem = this
                                      laydate(end);
                                    });
                                });
                            </script>
                    <div class="row">

                        <table class="table table-hover table-" data-tablesaw-mode="stack">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>用户账号</th>
                                    <th>转入会员</th>
                                    <th>货币类型</th>
                                    <th>金额</th>
                                    <!-- <th>手续费</th> -->
                                    <th>时间</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody>
                            <volist name="list" id="vo">
                                <tr>
                                    <td>{$vo['id']}</td>
                                    <td>{$vo['out_userid']}</td>
                                    <td>{$vo['in_userid']}</td>
                                    <td><eq name="vo['type']" value="0">激活积分转给其他会员</eq>
                                    <eq name="vo['type']" value="1">注册积分转给其他会员</eq>
                                    <eq name="vo['type']" value="3">现金点值 转 幸运积分</eq>
                                    <eq name="vo['type']" value="2">配送积分 转 注册积分</eq>
                                    <eq name="vo['type']" value="4">配送积分 转 幸运积分</eq>
                                    <eq name="vo['type']" value="5">购物点值转给其他会员</eq>
                                    <eq name="vo['type']" value="6">现金点值 转 购物点值</eq></td>
                                    <td>{$vo['epoint']}</td>
                                    <td>{$vo['rdt']|date='Y-m-d H:i:s',###}</td>
                                    <td><span class="label label-success">已完成</span></td>
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                        {$page}
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <!--  <i class="fa fa-money modal-icon"></i>-->
                <h4 class="modal-title">积分转账</h4>
                <!--<small class="font-bold">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>-->
            </div>
            <form role="form" id="sendForm" method="post" action="__URL__/transferMoneyAC" class="ajax-post">
            <div class="modal-body">
                <p>您目前的注册积分为：{$rs.agent_cash}<span class="label label-primary"></span></p>
                <p>您目前的激活积分为：{$rs.agent_kt}<span class="label label-primary"></span></p>
                <p>您目前的购物点值为：{$rs.buy_point}<span class="label label-primary"></span></p>
                
                    <input type="hidden" name="action" value="transfer_ajax">
                    <div class="form-group"><label>转账类型</label>
                        <select name="zztype"  class="form-control">
                            <option value="0">激活积分转出</option>
                                <option value="1">注册积分转出</option>
                                <option value="5">购物点值转出</option>
                                </select>
                            </div>
                            <div class="form-group"><label>转入用户账号<span id="showName" style="color: #1ab394"></span></label>
                                <input type="text" placeholder="" class="form-control" name="tousername" value="" id="tousername">
                                <script>
                                    $(function () {
                                        $("#tousername").change(function () {
                                            var username = $(this).val();
                                            $.get("__URL__/getUserName/userid/"+username,function (data) {
                                                $("#showName").html("（"+data.info+" ）");
                                            });

                                        });
                                    });
                                </script>
                            </div>
                            <div class="form-group"><label>转出金额</label>
                                <div id="price_slider" style="margin: 10px auto"></div>
                                <input type="text" placeholder="" class="form-control" name="price" value="" id="price">
                            </div>
                            <div class="form-group"><label>二级密码</label>
                                <div id="price_slider" style="margin: 10px auto"></div>
                                <input type="password" placeholder="" class="form-control" name="password" id="password">
                            </div>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                        <button type="button" class="ladda-button ladda-button-demo btn btn-primary" id="sendUp" data-style="zoom-in">确认转账</button>
                    </div>
                    </form>
                     <script type="text/javascript">
                                    
                                    layui.use('layer',function() {
                                        $('#sendUp').on('click',function() {

                                        	$('#sendUp').attr('disabled', "true");
                                        $.post($('#sendForm').attr('action')
                                            ,$('#sendForm').serialize(),
                                            function(data) {
                                                if (data.status) {
                                                    layer.msg(data.info,{end:function() {
                                                        location.reload();
                                                    }});
                                                }else{$('#sendUp').removeAttr('disabled');
                                                    layer.msg(data.info);
                                                }
                                            });
                                        return false;
                                    });
                                    });
                                    
                                </script>
                </div>
            </div>
        </div>
    </block>