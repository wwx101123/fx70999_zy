<extend name="Public:adminheader" />
<block name="menu">
    <div class="wrapper wrapper-content animated fadeInRight" class="clearfix">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>轮播图片编辑
                        <small></small>
                    </h5>
                </div>
                <div class="ibox-content">
                    <form class="form-horizontal ajax-form layui-form" action="{:U('Gouwu/img_inserts')}" method="post" enctype="multipart/form-data" name="form1">

                        <div class="form-group">
                            <label class="col-sm-2 control-label">产品名称： </label>

                            <div class="col-sm-10">
                                <input name="title" type="text" id="title" value="" class="form-control" required="">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">类型： </label>

                            <div class="col-sm-10">
                                <input type="radio" name="isreg" value="0" title="外部" checked="">
                                <input type="radio" name="isreg" value="1" title="内部">
                            </div>
                        </div>
						<div class="hr-line-dashed"></div>
                       
                        <div class="form-group">
                            <label class="col-sm-2 control-label">图片： </label>

                            <div class="col-sm-10" id="proimgs">
                                <input type="file" name="file" id="proimg" class="layui-upload-file form-control"> &nbsp;最佳分辨率1920*450
                                <label class="layui-btn layui-hide" id="showImg">预览图片</label>
                                </div>
                                <input type="hidden" value="" id="proimgurl" name="image">
                        </div>
                        <div class="hr-line-dashed"></div>


                        <div class="form-group">
                            <label class="col-sm-2 control-label">说明： </label>
                            <div class="col-sm-10">
                                <input type="hidden" name="detail" id="detail">
                                <textarea name="content" id="demo" style="display: none;"></textarea>
                            <script>
                                layui.use(['layedit','upload','layer'], function(){
                                  var layedit = layui.layedit;
                                  var layer = layui.layer;
                                  layedit.set({
                                      uploadImage: {
                                        url: '__URL__/upload_layedit_pp'
                                      }
                                    });
                                   edit=layedit.build('demo'); //建立编辑器
                                   $('.ajax-submit').on('click',function () {
                                       $('#detail').val(layedit.getContent(edit));
                                   });
                                  layui.upload({
                                    url: '__URL__/upload_fengcai_pp'
                                    ,elem: '#proimg' //指定原始元素，默认直接查找class="layui-upload-file"
                                    // ,method: 'get' //上传接口的http类型
                                    ,success: function(res){
                                        var PUBLIC="__"+"PUBLIC__";
                                        var str=res.url;
                                      $('#proimgurl').val(str.replace(PUBLIC,'__PUBLIC__'));
                                      $('#showImg').removeClass('layui-hide');
                                      return false;
                                    }
                                  });
                                  $('#showImg').on('click',function() {
                                      layer.open({
                                          type: 1,
                                          title: false,
                                          offset: '300px',
                                          closeBtn: 0,
                                          area: 'auto',
                                          maxWidth:'500px',
                                          skin: 'layui-layer-nobg', //没有背景色
                                          shadeClose: true,
                                          content: "<img src='"+$('#proimgurl').val()+"'>"
                                        });
                                  })
                                  $('.ajax-submit').on('click',function() {
                                    form=$('.ajax-form');
                                    $.post(form.attr('action'),form.serialize(),
                                        function(data) {
                                            // console.log(data);
                                            if (data.status) {
                                                layer.msg(data.info,{offset:'100px',end:function() {
                                                if (data.url) {
                                                    location.href=data.url;
                                                }else{
                                                    location.reload();
                                                }
                                            }});
                                            }else{

                                                layer.msg(data.info);
                                            }
                                        });
                                    return false;
                                });
                                });
                            </script>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <input type="hidden" name="id" value="">
                                <input type="hidden" name="pageno" value="">
                                <input class="btn btn-warning ajax-submit" type="submit" id="but" value="添加" name="but">
                                <button class="btn btn-white" onclick="history.go(-1)">取消</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</block>