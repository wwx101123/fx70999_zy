<extend name="Public:header" />
<block name="breadcrumb">
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>卖出股票</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="{:U('Index/index')}">首页</a>
                </li>
                <li>
                    <a>股票市场</a>
                </li>
                <li class="active">
                    <strong>卖出股票</strong>
                </li>
            </ol>
        </div>
    </div>
</block>

<block name="menu">
    <div class="wrapper wrapper-content animated fadeInRight">


        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>卖出股票记录 </h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <form class="form-inline title-form" name="form2" method="post"
                            action="?action1=query">
                            <div class="form-group" id="data_5">
                                <label class="font-noraml"></label>
                                <div class="input-daterange input-group" id="datepicker">
                                    <input type="text" class="form-control" name="time1"
                                    placeholder="开始日期" id="time1" value="<notempty name='time1'>{$time1}</notempty>">
                                    <span class="input-group-addon">到</span>
                                    <input type="text" class="form-control" name="time2"
                                    placeholder="截止日期" id="time2" value="<notempty name='time2'>{$time2}</notempty>">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">查询</button>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">卖出股票</button>
                        </form>
                    </div>
                            <script type="text/javascript">
                                layui.use('laydate', function(){
                                  var laydate = layui.laydate;
                                      var start = {
                                      // min: laydate.now(-2)
                                      max: '2099-06-16 23:59:59'
                                      ,istoday: false
                                      ,choose: function(datas){
                                        end.min = datas; //开始日选好后，重置结束日的最小日期
                                        end.start = datas //将结束日的初始值设定为开始日
                                      }
                                    };
                                    
                                    var end = {
                                      min: laydate.now()
                                      ,max: '2099-06-16 23:59:59'
                                      ,istoday: false
                                      ,choose: function(datas){
                                        start.max = datas; //结束日选好后，重置开始日的最大日期
                                      }
                                    };
                                    
                                    $('#time1').on('click',function(){
                                      start.elem = this;
                                      laydate(start);
                                    });
                                    $('#time2').on('click',function(){
                                      end.elem = this
                                      laydate(end);
                                    });
                                });
                            </script>
                    <div class="row">

                        <table class="table table-hover table-" data-tablesaw-mode="stack">
                            <thead>
                                <tr>
                                    <th>出售时间</th>
                                    <th>总量</th>
                                    <th>已卖出</th>
                                    <th>剩余</th>
                                    <th>单价</th>
                                    <th>金额</th> 
                                    <th>状态</th>
                                    <th>功能</th>
                                </tr>
                            </thead>
                            <tbody>
                            <volist name="list" id="vo">
                                <tr>
                                    <td>{$vo.ctime|date='Y-m-d H:i:s',###}</td>
                                    <td>{$vo.num}</td>
                                    <td>{$vo.trade_total_num}</td>
                                    <td>{$vo.shengyu_num}</td>
                                    <td>{$vo.price}</td>
                                    <td>{$vo.total}</td><td><eq name="vo.status" value="0">挂单中</eq> <eq
											name="vo.status" value="1">已成交</eq></td>
										<td width="110"><eq name="vo.status" value="0">
								<a class="cancel" id="{$vo.id}">撤销委托</a></eq> <eq name="vo.status"
									value="1">---</eq></td>        </tr>
                            </volist>
                            </tbody>
                        </table>
                        {$page}
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">卖出股票</h4>
            </div>
            <form role="form" id="sendForm" method="post" action="__URL__/sell" class="ajax-post">
            <div class="modal-body">
                <p>您目前的股票(股)为：{$live_gp}<span class="label label-primary"></span></p>
                
                    <input type="hidden" name="action" value="transfer_ajax">
					<div class="form-group"><label>出售数量</label>
						<div id="price_slider" style="margin: 10px auto"></div>
						<input type="text" placeholder="" class="form-control" name="num" value="" id="sNun" onblur="value=value.replace(/[^0-9.]/g,'');tot_price();">
						<input type="hidden"  name="coin" value="kg" >
					</div>
					<div class="form-group"><label>当前价格</label>
						<div id="price_slider" style="margin: 10px auto"></div>
						<input type="text" placeholder="" class="form-control" name="price" value="{$one_price}" id="one_price" readonly>
					</div>
					<div class="form-group"><label>总售价<span id="showName" style="color: #1ab394"></span></label>
						<span style="color:#960" id="tot_price">0</span></div>
					<div class="form-group"><label>二级密码</label>
						<div id="price_slider" style="margin: 10px auto"></div>
						<input type="password" placeholder="" class="form-control" name="paypwd" id="gp_pwd">
					</div>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                        <eq name="close_gp" value="0">
                      <button type="submit" class="ladda-button ladda-button-demo btn btn-primary" id="sendUp" data-style="zoom-in">确认</button>
                      <else />
                      <span style="color:#F00">股市交易已关闭</span> </eq>
                        
                    </div>
                    </form>
                </div>
            </div>
        </div>
        <script type="text/javascript">
        $(document).ready(function() {
    		$('.cancel').click(function() {

    			var id = $(this).attr('id');
    			var coin = 'kg';
    			$.post('__URL__/cancel', {
    				id : id,
    				coin : coin
    			}, function(d) {
    				alert(d.info);
    				if (d.status == 0) {
    					location.reload();
    				}
    			});
    		});
    		$(".tenBodyTitle").children("a").on("click", function() {
    			$(this).addClass("cur").siblings().removeClass("cur");
    		});
    	});
function tot_price(){
	var one_price = document.getElementById('one_price').value;//单价
	var sNun	= document.getElementById('sNun').value;//数量
	var t_price = formatNumberUnitsDivd(parseFloat(sNun * one_price)); 
	document.getElementById('tot_price').innerHTML = t_price+'';
}
function formatNumberUnitsDivd(num) {
	return num.toFixed(4);
}
function checkf(){
	if(document.form1.one_price.value==""){
		alert("请输入价格");
		document.form1.one_price.focus();
		return false;
	}
	if(document.form1.sNun.value==""){
		alert("请输入出售股票(股)数量");
		document.form1.sNun.focus();
		return false;
	}
	var one_price = document.getElementById('one_price').value;//单价
	var sNun	= document.getElementById('sNun').value;//数量
	var t_price = formatNumberUnitsDivd(parseFloat(sNun * one_price)); 
	if(confirm("您确定要出售 "+document.form1.sNun.value+" 股 股票(股)吗？\n\n售出单价："+document.form1.one_price.value+"\n\n售出总额："+t_price)){
		return true;
	}else{
		return false;
	}
}
</script>
    </block>
