(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/createOrder"],{"3f84":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(i("880c")),c=o(i("6511")),n=i("2f62"),s=o(i("7eab"));function o(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},a=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),a.forEach(function(e){l(t,e,i[e])})}return t}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var u={components:{MescrollUni:a.default,uniNumberBox:s.default},computed:r({},(0,n.mapState)(["hasLogin","userInfo","bi"])),data:function(){return{mescroll:null,downOption:{use:!0,auto:!0},upOption:{use:!1,auto:!1},total:0,allChecked:!1,empty:!1,cartList:[],cart_ids:""}},onPageScroll:function(t){this.mescroll&&this.mescroll.onPageScroll(t)},onLoad:function(){if(void 0==this.userInfo){var e="/pages/public/login";t.navigateTo({url:e})}},onShow:function(){console.log(2222),this.refresh()},watch:{cartList:function(t){var e=0===t.length;this.empty!==e&&(this.empty=e)}},methods:{refresh:function(){var t=this;t.mescrollInit(t.mescroll),t.downCallback(t.mescroll)},mescrollInit:function(t){this.mescroll=t},downCallback:function(e){var i=this;t.request({url:c.default.dui_cart_items,data:{is_mobile:1,user_id:i.userInfo.id},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(1==t.data.status){var a=t.data.data;if(null!=a){console.log(a);var c=a.map(function(t){return t.checked=!0,t});i.cart_ids=t.data.cart_ids,i.cartList=c}i.calcTotal()}setTimeout(function(){e.endSuccess()},1e3)}})},onImageLoad:function(t,e){this.$set(this[t][e],"loaded","loaded")},onImageError:function(t,e){this[t][e].image="/static/errorImage.jpg"},navToLogin:function(){t.navigateTo({url:"/pages/public/login"})},check:function(t,e){if("item"===t)this.cartList[e].checked=!this.cartList[e].checked;else{var i=!this.allChecked,a=this.cartList;a.forEach(function(t){t.checked=i}),this.allChecked=i}this.calcTotal(t)},numberChange:function(e){this.cartList[e.index].number=e.number;var i=this;t.request({url:c.default.dui_cart_goods_update,data:{is_mobile:1,user_id:i.userInfo.id,article_id:i.cartList[e.index].article_id,goods_id:i.cartList[e.index].goods_id,quantity:e.number},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){t.data.status}}),this.calcTotal()},deleteCartItem:function(e){var i=this.cartList,a=i[e],n=a.id;this.cartList.splice(e,1),this.calcTotal();var s=this;t.request({url:c.default.dui_cart_goods_delete,data:{is_mobile:1,user_id:s.userInfo.id,article_id:a.article_id,goods_id:a.goods_id,cart_ids:n},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){t.data.status}}),t.hideLoading()},clearCart:function(){var e=this;t.showModal({content:"清空兑换列表？",success:function(i){if(i.confirm){var a=e;t.request({url:c.default.dui_cart_goods_delete,data:{is_mobile:1,user_id:a.userInfo.id,cart_ids:a.cart_ids},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){1==t.data.status&&(a.cartList=[])}})}}})},calcTotal:function(){var t=this.cartList;if(0!==t.length){var e=0,i=!0;t.forEach(function(t){!0===t.checked?e+=t.price*t.number:!0===i&&(i=!1)}),this.allChecked=i,this.total=Number(e.toFixed(2))}else this.empty=!0},createOrder:function(){var e=this;t.request({url:c.default.dui_shop,data:{is_mobile:1,user_id:e.userInfo.id},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(i){1==i.data.status?(e.$api.msg(i.data.info),setTimeout(function(){t.navigateBack()},1e3)):e.$api.msg(i.data.info)}})}}};e.default=u}).call(this,i("6e42")["default"])},4439:function(t,e,i){"use strict";i.r(e);var a=i("3f84"),c=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);e["default"]=c.a},6777:function(t,e,i){},"6ecb":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"container"},[i("mescroll-uni",{attrs:{up:t.upOption,eventid:"e71e2b9c-8",mpcomid:"e71e2b9c-1"},on:{down:t.downCallback,init:t.mescrollInit}},[t.hasLogin&&!0!==t.empty?i("view",[i("view",{staticClass:"cart-list"},t._l(t.cartList,function(e,a){return i("block",{key:e.id},[i("view",{staticClass:"cart-item",class:{"b-b":a!==t.cartList.length-1}},[i("view",{staticClass:"image-wrapper"},[i("image",{staticClass:"loaded",attrs:{src:e.icon,mode:"aspectFill","lazy-load":"",eventid:"e71e2b9c-1-"+a},on:{load:function(e){t.onImageLoad("cartList",a)},error:function(e){t.onImageError("cartList",a)}}}),i("view",{staticClass:"yticon icon-xuanzhong2 checkbox",class:{checked:e.checked},attrs:{eventid:"e71e2b9c-2-"+a},on:{click:function(e){t.check("item",a)}}})]),i("view",{staticClass:"item-right"},[i("text",{staticClass:"clamp title"},[t._v(t._s(e.title))]),i("text",{staticClass:"attr"},[t._v(t._s(e.attr_val))]),i("text",{staticClass:"price"},[t._v("¥"+t._s(e.price))]),i("uni-number-box",{staticClass:"step",attrs:{min:1,max:e.stock,value:e.number,isMax:e.number>=e.stock,isMin:1===e.number,index:a,eventid:"e71e2b9c-3-"+a,mpcomid:"e71e2b9c-0-"+a},on:{eventChange:t.numberChange}})],1),i("text",{staticClass:"del-btn yticon icon-fork",attrs:{eventid:"e71e2b9c-4-"+a},on:{click:function(e){t.deleteCartItem(a)}}})])])})),i("view",{staticClass:"action-section"},[i("view",{staticClass:"checkbox"},[i("image",{attrs:{src:t.allChecked?"/static/selected.png":"/static/select.png",mode:"aspectFit",eventid:"e71e2b9c-5"},on:{click:function(e){t.check("all")}}}),i("view",{staticClass:"clear-btn",class:{show:t.allChecked},attrs:{eventid:"e71e2b9c-6"},on:{click:function(e){t.clearCart(t.cart_ids)}}},[t._v("清空")])]),i("view",{staticClass:"total-box"},[i("text",{staticClass:"price"},[t._v("¥"+t._s(t.total))])]),i("button",{staticClass:"no-border confirm-btn",attrs:{type:"primary",eventid:"e71e2b9c-7"},on:{click:t.createOrder}},[t._v("去兑换")])],1)]):i("view",{staticClass:"empty"},[i("image",{attrs:{src:"/static/emptyCart.jpg",mode:"aspectFit"}}),t.hasLogin?i("view",{staticClass:"empty-tips"},[t._v("空空如也")]):i("view",{staticClass:"empty-tips"},[t._v("空空如也"),i("view",{staticClass:"navigator",attrs:{eventid:"e71e2b9c-0"},on:{click:t.navToLogin}},[t._v("去登陆>")])])])])],1)},c=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return c})},"79fe":function(t,e,i){"use strict";var a=i("6777"),c=i.n(a);c.a},"9ec3":function(t,e,i){"use strict";i.r(e);var a=i("6ecb"),c=i("4439");for(var n in c)"default"!==n&&function(t){i.d(e,t,function(){return c[t]})}(n);i("79fe");var s=i("2877"),o=Object(s["a"])(c["default"],a["a"],a["b"],!1,null,null,null);e["default"]=o.exports},e912:function(t,e,i){"use strict";i("feb3");var a=n(i("b0ce")),c=n(i("9ec3"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,a.default)(c.default))}},[["e912","common/runtime","common/vendor"]]]);