(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/cart"],{"0197":function(t,e,a){"use strict";a.r(e);var i=a("b812"),c=a("eafd");for(var n in c)"default"!==n&&function(t){a.d(e,t,function(){return c[t]})}(n);a("db88");var s=a("2877"),r=Object(s["a"])(c["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"1b54":function(t,e,a){},4551:function(t,e,a){"use strict";a("feb3");var i=n(a("b0ce")),c=n(a("0197"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(c.default))},"6df5":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(a("880c")),c=r(a("6511")),n=a("2f62"),s=r(a("7eab"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},i=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),i.forEach(function(e){l(t,e,a[e])})}return t}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u={components:{MescrollUni:i.default,uniNumberBox:s.default},computed:o({},(0,n.mapState)(["hasLogin","userInfo","bi"])),data:function(){return{mescroll:null,downOption:{use:!0,auto:!0},upOption:{use:!1,auto:!1},total:0,allChecked:!1,empty:!1,cartList:[],cart_ids:""}},onPageScroll:function(t){this.mescroll&&this.mescroll.onPageScroll(t)},onLoad:function(){if(void 0==this.userInfo){var e="/pages/public/login";t.navigateTo({url:e})}},onShow:function(){console.log(2222),this.refresh()},watch:{cartList:function(t){var e=0===t.length;this.empty!==e&&(this.empty=e)}},methods:{refresh:function(){var t=this;t.mescrollInit(t.mescroll),t.downCallback(t.mescroll)},mescrollInit:function(t){this.mescroll=t},downCallback:function(e){var a=this;t.request({url:c.default.get_cart_itemsUrl,data:{is_mobile:1,user_id:a.userInfo.id},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(1==t.data.status){var i=t.data.data;if(null!=i){console.log(i);var c=i.map(function(t){return t.checked=!0,t});a.cart_ids=t.data.cart_ids,a.cartList=c}a.calcTotal()}setTimeout(function(){e.endSuccess()},1e3)}})},onImageLoad:function(t,e){this.$set(this[t][e],"loaded","loaded")},onImageError:function(t,e){this[t][e].image="/static/errorImage.jpg"},navToLogin:function(){t.navigateTo({url:"/pages/public/login"})},check:function(t,e){if("item"===t)this.cartList[e].checked=!this.cartList[e].checked;else{var a=!this.allChecked,i=this.cartList;i.forEach(function(t){t.checked=a}),this.allChecked=a}this.calcTotal(t)},numberChange:function(e){this.cartList[e.index].number=e.number;var a=this;t.request({url:c.default.cart_goods_updateUrl,data:{is_mobile:1,user_id:a.userInfo.id,article_id:a.cartList[e.index].article_id,goods_id:a.cartList[e.index].goods_id,quantity:e.number},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){t.data.status}}),this.calcTotal()},deleteCartItem:function(e){var a=this.cartList,i=a[e],n=i.id;this.cartList.splice(e,1),this.calcTotal();var s=this;t.request({url:c.default.cart_goods_delete,data:{is_mobile:1,user_id:s.userInfo.id,article_id:i.article_id,goods_id:i.goods_id,cart_ids:n},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){t.data.status}}),t.hideLoading()},clearCart:function(){var e=this;t.showModal({content:"清空购物车？",success:function(a){if(a.confirm){var i=e;t.request({url:c.default.cart_goods_delete,data:{is_mobile:1,user_id:i.userInfo.id,cart_ids:i.cart_ids},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){1==t.data.status&&(i.cartList=[])}})}}})},calcTotal:function(){var t=this.cartList;if(0!==t.length){var e=0,a=!0;t.forEach(function(t){!0===t.checked?e+=t.price*t.number:!0===a&&(a=!1)}),this.allChecked=a,this.total=Number(e.toFixed(2))}else this.empty=!0},createOrder:function(){var e=this.cartList,a=[];e.forEach(function(t){t.checked&&a.push({attr_val:t.attr_val,number:t.number})}),t.navigateTo({url:"/pages/order/createOrder?data=".concat(JSON.stringify({goodsData:a}))})}}};e.default=u}).call(this,a("6e42")["default"])},b812:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"container"},[a("mescroll-uni",{attrs:{up:t.upOption,eventid:"70620294-8",mpcomid:"70620294-1"},on:{down:t.downCallback,init:t.mescrollInit}},[t.hasLogin&&!0!==t.empty?a("view",[a("view",{staticClass:"cart-list"},t._l(t.cartList,function(e,i){return a("block",{key:e.id},[a("view",{staticClass:"cart-item",class:{"b-b":i!==t.cartList.length-1}},[a("view",{staticClass:"image-wrapper"},[a("image",{staticClass:"loaded",attrs:{src:e.icon,mode:"aspectFill","lazy-load":"",eventid:"70620294-1-"+i},on:{load:function(e){t.onImageLoad("cartList",i)},error:function(e){t.onImageError("cartList",i)}}}),a("view",{staticClass:"yticon icon-xuanzhong2 checkbox",class:{checked:e.checked},attrs:{eventid:"70620294-2-"+i},on:{click:function(e){t.check("item",i)}}})]),a("view",{staticClass:"item-right"},[a("text",{staticClass:"clamp title"},[t._v(t._s(e.title))]),a("text",{staticClass:"attr"},[t._v(t._s(e.attr_val))]),a("text",{staticClass:"price"},[t._v("¥"+t._s(e.price))]),a("uni-number-box",{staticClass:"step",attrs:{min:1,max:e.stock,value:e.number,isMax:e.number>=e.stock,isMin:1===e.number,index:i,eventid:"70620294-3-"+i,mpcomid:"70620294-0-"+i},on:{eventChange:t.numberChange}})],1),a("text",{staticClass:"del-btn yticon icon-fork",attrs:{eventid:"70620294-4-"+i},on:{click:function(e){t.deleteCartItem(i)}}})])])})),a("view",{staticClass:"action-section"},[a("view",{staticClass:"checkbox"},[a("image",{attrs:{src:t.allChecked?"/static/selected.png":"/static/select.png",mode:"aspectFit",eventid:"70620294-5"},on:{click:function(e){t.check("all")}}}),a("view",{staticClass:"clear-btn",class:{show:t.allChecked},attrs:{eventid:"70620294-6"},on:{click:function(e){t.clearCart(t.cart_ids)}}},[t._v("清空")])]),a("view",{staticClass:"total-box"},[a("text",{staticClass:"price"},[t._v("¥"+t._s(t.total))])]),a("button",{staticClass:"no-border confirm-btn",attrs:{type:"primary",eventid:"70620294-7"},on:{click:t.createOrder}},[t._v("去结算")])],1)]):a("view",{staticClass:"empty"},[a("image",{attrs:{src:"/static/emptyCart.jpg",mode:"aspectFit"}}),t.hasLogin?a("view",{staticClass:"empty-tips"},[t._v("空空如也"),t.hasLogin?a("navigator",{staticClass:"navigator",attrs:{url:"../index/index","open-type":"switchTab"}},[t._v("随便逛逛>")]):t._e()],1):a("view",{staticClass:"empty-tips"},[t._v("空空如也"),a("view",{staticClass:"navigator",attrs:{eventid:"70620294-0"},on:{click:t.navToLogin}},[t._v("去登陆>")])])])])],1)},c=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return c})},db88:function(t,e,a){"use strict";var i=a("1b54"),c=a.n(i);c.a},eafd:function(t,e,a){"use strict";a.r(e);var i=a("6df5"),c=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);e["default"]=c.a}},[["4551","common/runtime","common/vendor"]]]);